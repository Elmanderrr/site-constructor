!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="test",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n={root:document.body,qs:(e,t=(void 0).root)=>t.querySelector(e),qsa:(e,t=(void 0).root)=>t.querySelectorAll(e),wrap(e,t){let r=this.createElement(e);return Array.from(t.children).forEach(e=>r.appendChild(e)),r},findDeepest(e){for(;e.children.length>0;)e=e.children[0];return e},extend(e={},t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},createElement(e){let t=document.createElement("div");if(t.innerHTML=e,t.children.length>1){let e=document.createElement("div");e.appendChild(t.children[0].cloneNode()),console.info(`\n                String must contain only the 1 wrapper, ${t.children.length} given. ${e.innerHTML} will be returned\n            `)}return t.children[0]},get matches(){return document.body.matchesSelector||document.body.webkitMatchesSelector||document.body.mozMatchesSelector||document.body.msMatchesSelector||document.body.webkitMatchesSelector||document.body.matchesSelector},findParent(e,t){for(;e.parentNode&&!this.matches.call(e,t);)e=e.parentNode;return 9===e.nodeType?null:e},mix(...e){class t{}for(let r of e)this.copyProperties(t,r),this.copyProperties(t.prototype,r.prototype);return t},copyProperties(e,t){for(let r of Reflect.ownKeys(t))if("constructor"!==r&&"prototype"!==r&&"name"!==r){let n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n)}}};var o=class{constructor(e){this.mediator=e,this._events=[]}attachMultiEvents(e,t){Array.from(e).forEach(e=>{let r=Object.assign({},t);e.addEventListener(t.event,t.handler,!1),this._events.push(Object.assign(r,{selector:e,ownerDocument:e.ownerDocument}))})}attachTargetEvents(e){let t=1===e.selector.nodeType?e.selector:n.qs(e.selector);t.addEventListener(e.event,e.handler,!1),this._events.push(Object.assign(e,{selector:t,ownerDocument:t.ownerDocument}))}attachEvents(e,t){return e.forEach(e=>t?this.attachMultiEvents(t,e):this.attachTargetEvents(e)),this}detachEventsByName(e){e.forEach(this.detach.bind(this))}detach(e){this._events=this._events.filter(t=>{let r=t.event===e;return r&&t.selector.removeEventListener(t.event,t.handler,!1),!r})}detachInactive(){this._events=this._events.filter(e=>{let t=e.ownerDocument.contains(e.selector);return t||e.selector.removeEventListener(e.event,e.handler,!1),t})}parseDeclaredEvents(e,t){this.detachInactive(),Array.from(t).forEach(t=>{let r=t.getAttribute("data-event").split(":"),n=r[0],o="function"==typeof e[r[1]]?e[r[1]].bind(e):null;if(!o)return console.error(`Handler ${r[1]} must be the function, ${o} given`);this.attachEvents([{event:n,handler:o,selector:t}])})}};var s=class{getDropAreaEvents(){return[{event:"drop",handler:this.onDropAreaDrop.bind(this)},{event:"dragover",handler:this.onDropAreaDragOver.bind(this)},{event:"dragenter",handler:this.onDropAreaDragEnter.bind(this)},{event:"dragleave",handler:this.onDropAreaDragLeave.bind(this)},{event:"dragend",handler:this.onDropAreaDragEnd.bind(this)}]}canBeDropped(e){let t;return n.matches.call(this.dragSrcElement,"[interactive-element]")||(t=n.findParent(this.dragSrcElement,"[interactive-element]")),(t||this.dragSrcElement).getAttribute("data-dest")===e.getAttribute("role")}attachDropArea(){return this.dispatcher.attachEvents(this.getDropAreaEvents(),this.$iframeContent.querySelectorAll("[drop-container]")),this}onDropAreaDragEnd(e){this.dragSrcElement&&(this.dragSrcElement=null,this.mediator.pub(e.type,{src:e.target}))}onDropAreaDragEnter(e){this.dragSrcElement&&e.target!=this.dragSrcElement&&this.canBeDropped(e.target)&&(e.target.classList.add("drag-enter"),Array.from(e.target.querySelectorAll("*")).forEach(e=>e.style.pointerEvents="none"),this.dispatcher.mediator.pub("drop-area:drag-enter",{src:e.target}))}onDropAreaDragLeave(e){this.dragSrcElement&&(e.target.classList.remove("drag-enter"),this.dispatcher.mediator.pub("drop-area:drag-leave",{src:e.target}))}onDropAreaDragOver(e){e.preventDefault()}onDropAreaDrop(e){if(e.preventDefault(),!n.matches.call(e.target,"[role]"))var t=n.findParent(e.target,"[role]");this.dragSrcElement&&e.target!=this.dragSrcElement&&this.canBeDropped(t||e.target)&&(Array.from(e.target.querySelectorAll("*")).forEach(e=>e.style.pointerEvents=""),e.target.classList.remove("drag-enter"),this.dispatcher.mediator.pub(`drop-area:${e.type}`,{src:this.dragSrcElement,dist:t||e.target}))}insertHTML(e,t,r){let o=n.createElement("<div switchable></div>");o.innerHTML=t,r&&Object.keys(r).forEach(e=>{o.setAttribute(`data-${e}`,r[e])}),e.appendChild(o)}insertHTMLToContainer(e,t,r={}){const n=this.$iframeContent.querySelector(`[role=${t}]`);if(!n)throw Error(`There's no container with role ${t}`);this.insertHTML(n,e,r)}};class i{static get editorModes(){return[{name:"blocks",selector:".blocks-mode"},{name:"content",selector:".content-mode"},{name:"drag",selector:".drag-mode"},{name:"props",selector:".props-mode"},{name:"HTML",selector:".HTML-mode"}]}setActiveMode(e){i.editorModes.forEach(t=>{let r=this.$root.querySelector(t.selector);t.name===e?r.classList.add("active"):r.classList.remove("active")}),this.setMode(e),this.dispatcher.mediator.pub("mode:change",{mode:e})}getActiveMode(){return this.mode}getEditorEvents(){return[{event:"mouseover",handler:this.onMouseOver.bind(this),selector:this.$iframeContent.querySelector(".drop-area")},{event:"mouseout",handler:this.onMouseOut.bind(this),selector:this.$iframeContent.querySelector(".drop-area")},{event:"click",handler:this.onMouseClick.bind(this),selector:this.$iframeContent.querySelector(".drop-area")}]}attachEditorHandlers(){this.dispatcher.attachEvents(this.getEditorEvents())}blocksMode(e){this.setActiveMode("blocks"),this.dispatcher.attachEvents([{event:"mouseleave",handler:this.onBlockElementMouseLeave.bind(this)}],this.$iframeContent.querySelectorAll("[switchable]"))}contentMode(e){this.setActiveMode("content"),this.dispatcher.detachEventsByName(["mouseleave"])}dragMode(e){this.setActiveMode("drag"),this.dispatcher.detachEventsByName(["mouseleave"])}propsMode(e){this.setActiveMode("props"),this.dispatcher.detachEventsByName(["mouseleave"])}HTMLMode(e){this.setActiveMode("HTML"),this.disableModes(["blocks","content","drag"]),this.dispatcher.detachEventsByName(["mouseleave"]),this.initHTMLMode()}onMouseOver(e){let t=n.findParent(e.target,"[switchable]");if(t)switch(this.mode){case"blocks":this.onBlockElementHover(t);break;case"content":this.onContentElementHover(e.target);break;case"props":this.onPropsElementHover(e.target)}}onMouseOut(e){"content"!==this.mode&&"props"!==this.mode||e.target.classList.remove("on-hover")}onMouseClick(e){e.preventDefault(),n.findParent(e.target,"[switchable]")&&"content"===this.mode&&this.onContentElementClick(e.target),n.findParent(e.target,"[switchable]")&&"props"===this.mode&&this.onPropsElementClick(e.target)}disableModes(e=[]){i.editorModes.forEach(t=>{-1!==e.findIndex(e=>e===t.name)&&(n.qs(t.selector).disabled=!0)})}enableModes(e=[]){i.editorModes.forEach(t=>{-1!==e.findIndex(e=>e===t.name)&&(n.qs(t.selector).disabled=!1)})}}var a=i;var d=class{constructor(){this.$root=null,this._editableContent=[],this.init()}init(){if("undefined"==typeof nanoModal)throw"nanoModal plugin doesn't find";this.customizeModal(),this.modal||(this.modal=nanoModal("",{classes:"animated zoomIn",buttons:[{text:"OK",handler:e=>{this.applyContent(),setTimeout(e.hide,100)},primary:!0},{text:"Cancel",handler:e=>setTimeout(e.hide,100)}]}))}setContent(e){this.$root=e,this.modal&&this.modal.setContent(this.generateTemplate())}customizeModal(){nanoModal.customShow=((e,t)=>{document.body.classList.add("no-scroll"),t.overlay.el.classList.add("animated","fadeIn"),e(),t.modal.el.style.marginTop=-Math.abs(t.modal.el.offsetHeight)/2+"px"}),nanoModal.customHide=(e=>{document.body.classList.remove("no-scroll"),e()})}applyContent(){Array.from(this._editableContent).forEach(e=>{e.node.textContent=e.field.value})}generateTemplate(){return this.$form=document.createElement("form"),this.getNodes(this.$root).filter(this.filterNodes.bind(this)).reverse().forEach(e=>{let t=this.$form.appendChild(this.createField(e));this._editableContent.push({node:e,field:t.querySelector("textarea")})}),this.$form}filterNodes(e){return this.filter(e)||Array.from(e.childNodes).filter(this.filter).length}filter(e){return 3===e.nodeType&&e.textContent.trim()}getNodes(e){for(var t=e.childNodes,r=[],n=t.length;n--;)1!==t[n].nodeType&&3!==t[n].nodeType||(r=r.concat.apply(r,[t[n].childNodes.length?Array.from(t[n].childNodes):t[n]]));return r}createField(e){return n.createElement(`\n            <div class="modal-custom-content">\n                <textarea class="form-control" >${e.textContent}</textarea>\n            </div>\n        `)}};var l=class{onContentElementHover(e){this.isElementLegal(e)&&e.classList.add("on-hover")}onContentElementClick(e){this.isElementLegal(e)&&(this.editableInstance||(this.editableInstance=new d),this.editableInstance.setContent(e),this.editableInstance.modal.show())}editableElementAccept(e){this.dispatcher.mediator.pub("content:edited")}isElementLegal(e){let t=["[switchable]","[drop-container]"].some(t=>n.matches.call(e,t)),r=e.querySelectorAll("*").length,o=""===e.textContent.trim();return-1===["IMG","VIDEO"].indexOf(e.tagName)&&!t&&r<=3&&!o}};var c={styles:'\n        <link data-type="injectable" rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">\n\n        <style data-type="injectable">\n            .drag-enter, .droppable {\n                outline: 2px dashed #ff9f00 !important;\n            }\n\n            .droppable {\n                min-height: 200px;\n            }\n\n            .drop-area {\n                border: 2px solid black;\n                min-height: 500px;\n            }\n\n            .drop-area:after,\n             [switchable]:after{\n                content: \'\';\n                display: block;\n                visibility: visible;\n                height: 0;\n                clear: both;\n            }\n\n            [switchable] {\n                position: relative;\n            }\n\n            .switch-controllers {\n                position: absolute;\n                right: 0;\n                top: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(255,255,255,0.4);\n                animation: fadeIn 0.2s ease-out;\n                z-index: 99;\n                text-align: right;\n                padding: 5px;\n                cursor: pointer;\n            }\n\n            .switch-controllers button {\n                display: inline-block;\n                padding: 6px 10px;\n                cursor: pointer;\n                border:1px solid #ccc;\n                border-radius: 2px;\n            }\n\n            @keyframes fadeIn {\n                from {\n                    opacity:0;\n                    display: inline-block;\n                }\n                to {\n                    opacity: 1;\n                    display: inline-block;\n                }\n            }\n\n            .on-hover {\n                box-shadow: 0px 0px 0px 2px rgba(0,0,0,0.35);\n                border-radius: 2px;\n                cursor: text;\n            }\n\n        </style>\n    ',editPanel:'\n        <button class="btn btn-default blocks-mode" data-event="click:blocksMode">Blocks Mode</button>\n        <button class="btn btn-default content-mode" data-event="click:contentMode">Content Mode</button>\n        <button class="btn btn-default props-mode hidden" data-event="click:propsMode">Properties Mode</button>\n        <button class="btn btn-default drag-mode" data-event="click:dragMode">Drag Mode</button>\n        <button class="btn btn-default HTML-mode" data-event="click:HTMLMode">HTML mode</button>\n    ',switchElement:'\n        <div class="switch-controllers">\n            <button class="btn btn-default" data-event="click:editSourceElement">\n                <i class="fa fa-edit"></i>\n            </button>\n            <button class="btn btn-default" data-event="click:moveElementUp">\n                <i class="fa fa-arrow-up"></i>\n            </button>\n            <button class="btn btn-default" data-event="click:moveElementDown">\n                <i class="fa fa-arrow-down"></i>\n            </button>\n            <button class="btn btn-default" data-event="click:removeElement">\n                <i class="fa fa-close"></i>\n            </button>\n        </div>\n    ',propEditorContainer:'\n        <div class="prop-editor-holder">\n            <div class="prop-editor-body">\n\n            </div>\n        </div>\n    ',HTMLMode:'\n        <button class="btn btn-success codemirror-show-button" data-event="click:showCodeMirror">\n            <i class="fa fa-edit"></i>\n        </button>\n    ',codeMirror:'\n      <div class="codemirror-holder">\n        <div class="codemirror-ctrls">\n            <button class="btn btn-danger" data-event="click:cancelCodeMirrorEdit">\n                <i class="fa fa-close"></i>\n            </button>\n            <button class="btn btn-success" data-event="click:applyCodeMirrorEdit">\n                <i class="fa fa-save"></i>\n            </button>\n        </div>\n      </div>\n    ',getTemplate(e){if(!this[e])throw`There's no ${e} template`;return this[e]}};var h=class{constructor(e){this.props=e,this.escapeTimes=4,this.init()}init(){if("undefined"==typeof CodeMirror)throw"CodeMirror plugin doesn't find";this.createHolder(),this.initCodeMirror()}createHolder(){this.props.codemirror.holder.insertAdjacentHTML("beforeend",c.getTemplate("codeMirror")),this.holder=this.props.codemirror.holder.querySelector(".codemirror-holder")}initCodeMirror(){this.instance=CodeMirror(this.holder,this.props.codemirror.props)}setValue(e){this.editedElement=e,this.instance.getDoc().setValue(this.htmlUnescape(e.innerHTML)),setTimeout(()=>this.instance.refresh(),100)}htmlUnescape(e){for(let t=0;t<this.escapeTimes;t++)e=e.replace(/&quot;/g,"'").replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");return e}applyEditing(){this.editedElement.innerHTML=this.getValue(),this.hide()}getValue(){return this.htmlUnescape(this.instance.getValue())}show(){this.holder.classList.remove("hidden"),"function"==typeof this.props.codemirror.onShow&&this.props.codemirror.onShow()}hide(){this.holder.classList.add("hidden"),"function"==typeof this.props.codemirror.onShow&&this.props.codemirror.onHide()}};var p=class{onBlockElementHover(e){e.classList.contains("on-hover")||(e.classList.add("on-hover"),e.insertAdjacentHTML("beforeend",this.templates.getTemplate("switchElement")),this.parseEvents(this.$iframeContent))}onBlockElementMouseLeave(e){e.target.classList.remove("on-hover"),n.qs(".switch-controllers",e.target)&&e.target.removeChild(n.qs(".switch-controllers",e.target)),this.dispatcher.detachInactive()}moveElement(e,t){let r=t[{up:"previousElementSibling",down:"nextElementSibling"}[e]];"up"===e&&r&&t.parentNode.insertBefore(t,r),"down"===e&&r&&t.parentNode.insertBefore(t,r.nextElementSibling)}moveElementUp(e){let t=n.findParent(e.target,"[switchable]");this.moveElement("up",t)}moveElementDown(e){let t=n.findParent(e.target,"[switchable]");this.moveElement("down",t)}removeElement(e){let t=n.findParent(e.target,"[switchable]");t.parentNode.removeChild(t),this.dispatcher.mediator.pub("block:remove",{element:n.findParent(e.target,"[drop-container]")})}editSourceElement(e){let t=n.findParent(e.target,"[switchable]");t.removeChild(n.qs(".switch-controllers",t)),t.classList.remove("on-hover"),this.codeMirrorInstance||(this.codeMirrorInstance=new h({codemirror:{holder:this.$root,props:{mode:"htmlmixed",lineNumbers:!0,theme:"base16-dark"}}}),this.parseEvents()),this.codeMirrorInstance.setValue(t),this.codeMirrorInstance.show()}applyCodeMirrorEdit(){this.codeMirrorInstance.applyEditing(),this.dispatcher.mediator.pub("block:edited",{value:this.codeMirrorInstance.instance.getValue()})}cancelCodeMirrorEdit(){this.codeMirrorInstance.hide()}};var m=class{getDragElsEvents(){return[{event:"dragstart",handler:this.onDragElDragStart.bind(this)},{event:"dragend",handler:this.onDragElDragEnd.bind(this)}]}attachDragElements(e=[],t=this.getDragElsEvents()){return this.dispatcher.attachEvents(t,e),this}toggleDroppableArea(e=!1,t){let r=Array.from(n.qsa("[role]",this.$iframeContent));t=n.matches.call(t,"[interactive-element]")?t:n.findParent(t,"[interactive-element]"),r.forEach(r=>{t.getAttribute("data-dest")===r.getAttribute("role")&&r.classList[e?"add":"remove"]("droppable")})}onDragElDragStart(e){if("drag"!==this.mode)return e.preventDefault();this.toggleDroppableArea(!0,e.target),e.dataTransfer.setData("text","undefined"),e.target.classList.add("dragging"),this.dragSrcElement=e.target,this.dispatcher.mediator.pub(`block:${e.type}`,{src:e.target})}onDragElDragEnd(e){this.dragSrcElement=null,e.target.classList.remove("dragging"),this.toggleDroppableArea(!1,e.target),this.dispatcher.mediator.pub(`block:${e.type}`,{src:e.target})}};const u='\n    <div class="prop-editor-holder">\n        <div class="prop-editor-body">\n\n        </div>\n    </div>\n';var v=class{constructor(){this.init()}init(){this.create().attachElements()}show(e){}create(){return(this.$root=document.createElement("div")).innerHTML=u,document.body.appendChild(this.$root),this}attachElements(){this.$editorBody=this.$root.querySelector(".prop-editor-body")}};var b=class{onPropsElementHover(e){e.classList.add("on-hover")}onPropsElementClick(){this.delegateAction.apply(this,arguments)}delegateAction(e){switch(e.tagName){case"DIV":case"IMG":case"A":this.showPropertiesEditor(e)}}showPropertiesEditor(e){this.propEditor||(this.propEditor=new v)}};var g=class{getCodeMirrorContent(){return this.codeMirrorInstance?this.codeMirrorInstance.getValue():null}initHTMLMode(){this.codeMirrorInstance||(this.codeMirrorInstance=new h({codemirror:{holder:this.$root,parent:this,props:{mode:"htmlmixed",lineNumbers:!0,theme:"base16-dark"},onShow(){this.parent.codeMirrorInstance.editButton.classList.add("hidden")},onHide(){this.parent.codeMirrorInstance.editButton.classList.remove("hidden")}}}),this.transformCodeMirror(),this.parseEvents()),this.codeMirrorInstance.setValue(this.$iframeContent),this.codeMirrorInstance.show()}transformCodeMirror(){this.codeMirrorInstance.editButton=n.createElement(this.templates.getTemplate("HTMLMode")),this.$root.appendChild(this.codeMirrorInstance.editButton)}showCodeMirror(){this.codeMirrorInstance.show()}};var f=class extends(n.mix(s,a,n.mix(l,p,m,b,g))){constructor(e,t,r,o,s){super(),this.dispatcher=e,this.templates=t,this.iframeWrapper='<div class="drop-area"></div>',this.constructorWrapper='<div class="Web-constructor"></div>',this.$root=r.appendChild(n.createElement(this.constructorWrapper)),this.$dragElements=o,this.templates.__layout=s,this.MODES={content:"content",blocks:"blocks",props:"props",drag:"drag",HTML:"HTML",_default:"drag"}}init(){this.buildIframe().then(this.onAfterIframeLoad.bind(this))}getEditorCtrlsTemplate(){return this.templates.getTemplate("editPanel")}buildIframe(){return this.$iframe=document.createElement("iframe"),this.$root.appendChild(this.$iframe),this.transformIframe(this.templates.getTemplate("__layout")),this.$root.insertAdjacentHTML("afterbegin",this.getEditorCtrlsTemplate()),Promise.resolve()}transformIframe(e){this.$iframe.contentWindow.document.open(),this.$iframe.contentDocument.write(e),this.$iframe.contentWindow.document.close(),this.$iframe.contentDocument.head.innerHTML+=this.templates.getTemplate("styles"),this.$iframeContent=this.$iframe.contentWindow.document.body,this.$iframeContent.appendChild(n.wrap(this.iframeWrapper,this.$iframe.contentWindow.document.body))}onAfterIframeLoad(){this.attachDragElements(this.$dragElements).attachDropArea().attachEditorHandlers(),this.parseEvents(),this.dispatcher.mediator.pub("constructor:load")}setMode(e){this.mode=this.MODES[e]||this.MODES._default;try{this.$iframeContent.setAttribute("data-mode",this.mode)}catch(e){console.error(e)}}parseEvents(e=this.$root){this.dispatcher.parseDeclaredEvents(this,e.querySelectorAll("[data-event]"))}reload(e){if(!e)throw"Constructor: layout argument hasn't been given";this.transformIframe(e),this.attachDropArea().attachEditorHandlers(),this.parseEvents(),this.dispatcher.mediator.pub("constructor:layout-reload")}getIframeHTML(){let e=this.$iframe.contentDocument.cloneNode(!0);return Array.from(e.head.querySelectorAll('[data-type="injectable"]')).forEach(e=>e.parentNode.removeChild(e)),e.head.querySelectorAll('[data-type="injectable"]'),e.documentElement}},E={_version:"1.0.0",_observers:[],pub:function(e){for(var t=[].slice.call(arguments,0),r=0;r<this._observers.length;r++){var n=this._observers[r];e===n.name&&n.fn.apply(null,t)}},sub:function(e,t){var r=e;return this._observers.push({name:e,fn:t}),{unsub:function(){this._observers=this._observers.filter(function(e){return e.name!==r})}.bind(this)}}};var M=class{constructor(e={}){if(!e.holder||!e.layout)throw"Constructor: holder and layout must be defined while creating the new Constructor";this.mediator=E,this.dispatcher=new o(this.mediator),this.view=new f(this.dispatcher,c,e.holder,e.dragElements,e.layout),this._init()}_init(){this.view.init()}on(e,t){return this.mediator.sub(e,t)}addDraggableItems(e=[]){this.view.attachDragElements(e)}appendHTML(){this.view.insertHTML.apply(this.view,arguments)}appendHTMLToContainer(e,t,r){this.view.insertHTMLToContainer(e,t,r)}activateMode(){this.view.setActiveMode.apply(this.view,arguments)}reloadLayout(e){this.view.reload(e)}getHTML(){return this.view.getIframeHTML()}getCodeMirrorHTML(){return this.view.getCodeMirrorContent()}disableModes(e){this.view.disableModes(e)}enableModes(e){this.view.enableModes(e)}getCurrentMode(){return this.view.getActiveMode()}};window.Constructor=M;t.default=M}]);